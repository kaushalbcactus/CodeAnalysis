<div class="userdetails">
    <div class='customer-detail' [hidden]="hideDetail">
        Name:
        <div id="cd-name">{{global.currentUser.title}}</div>
    </div>
    <div class='customer-detail' [hidden]="hideDetail">
        Designation:
        <div id="cd-designation">{{global.currentUser.designation}}</div>
    </div>
    <a [hidden]="hideTable" (click)="downloadExcel(fb)" class="download-worksheet td-none"><i class="fa fa-download"
            aria-hidden="true"></i></a>
</div>

<p-table #fb [columns]="feedbackColumns" [value]="feedbackRows" [hidden]="hideTable" [rowsPerPageOptions]="[10,25,50]"
    [showCurrentPageReport]="true" currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
    [style]="{'font-size':'13px'}" styleClass="p-datatable-cactus p-datatable-gridlines"
    stateStorage="local" stateKey="feedbacksTable">
    <ng-template pTemplate="header" let-columns>
        <tr>
            <ng-container *ngFor="let col of columns">
                <th *ngIf="col.visibility">
                    <div class="p-d-flex p-jc-between p-ai-center">
                        {{col.header}}
                        <p-sortIcon [field]="col.field"></p-sortIcon>
                        <p-columnFilter  *ngIf="col.header != ''  && col.field !='Comments' " [field]="col.field" matchMode="in" display="menu" [showMatchModes]="false"
                            [showOperator]="false" [showAddButton]="false">
                            <ng-template pTemplate="header">
                                <div class="p-px-3 p-pt-3 p-pb-0">
                                    <span class="p-text-bold"> {{col.header}} Picker</span>
                                </div>
                            </ng-template>
                            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                <p-multiSelect [ngModel]="value" [options]="col.options" placeholder="All"
                                    (onChange)="filter($event.value)" optionLabel="label">
                                    <ng-template let-option pTemplate="item">
                                        <div class="p-multiselect-representative-option">
                                            <span class="p-ml-1">{{option.label}}</span>
                                        </div>
                                    </ng-template>
                                </p-multiSelect>
                            </ng-template>
                        </p-columnFilter>
                    </div>
                </th>
            </ng-container>
        </tr>
        <!-- <tr>
            <ng-container *ngFor="let col of columns">
                <th [ngSwitch]="col.field" *ngIf="!col.visibility">
                    <p-multiSelect *ngSwitchCase="'Date'" [style]="{'width':'100%'}" [options]="FBColArray.Date"
                        defaultLabel="Date" (onChange)="fb.filter($event.value, col.field, 'in')"
                        (keydown.enter)="$event.preventDefault()" filter="true" resetFilterOnHide="true"
                        (input)="optionFilter($event)" (onPanelShow)="isOptionFilter=true;" [maxSelectedLabels]="1">
                    </p-multiSelect>
                    <p-multiSelect *ngSwitchCase="'Task'" [style]="{'width':'100%'}" [options]="FBColArray.Task"
                        defaultLabel="Task" (onChange)="fb.filter($event.value, col.field, 'in')"
                        (keydown.enter)="$event.preventDefault()" filter="true" resetFilterOnHide="true"
                        (input)="optionFilter($event)" (onPanelShow)="isOptionFilter=true;" [maxSelectedLabels]="1">
                    </p-multiSelect>
                    <p-multiSelect *ngSwitchCase="'Type'" [style]="{'width':'100%'}" [options]="FBColArray.Type"
                        defaultLabel="Type" (onChange)="fb.filter($event.value, col.field, 'in')"
                        (keydown.enter)="$event.preventDefault()" filter="true" resetFilterOnHide="true"
                        (input)="optionFilter($event)" (onPanelShow)="isOptionFilter=true;" [maxSelectedLabels]="1">
                    </p-multiSelect>
                    <p-multiSelect *ngSwitchCase="'Feedbackfor'" [style]="{'width':'100%'}"
                        [options]="FBColArray.Feedbackfor" defaultLabel="Feedback For"
                        (onChange)="fb.filter($event.value, col.field, 'in')" (keydown.enter)="$event.preventDefault()"
                        filter="true" resetFilterOnHide="true" (input)="optionFilter($event)"
                        (onPanelShow)="isOptionFilter=true;" [maxSelectedLabels]="1"></p-multiSelect>
                    <p-multiSelect *ngSwitchCase="'FeedbackBy'" [style]="{'width':'100%'}"
                        [options]="FBColArray.FeedbackBy" defaultLabel="Feedback By"
                        (onChange)="fb.filter($event.value, col.field, 'in')" (keydown.enter)="$event.preventDefault()"
                        filter="true" resetFilterOnHide="true" (input)="optionFilter($event)"
                        (onPanelShow)="isOptionFilter=true;" [maxSelectedLabels]="1"></p-multiSelect>
                    <p-multiSelect *ngSwitchCase="'Rating'" [style]="{'width':'100%'}" [options]="FBColArray.Rating"
                        defaultLabel="Rating" (onChange)="fb.filter($event.value, col.field, 'in')"
                        (keydown.enter)="$event.preventDefault()" filter="true" resetFilterOnHide="true"
                        (input)="optionFilter($event)" (onPanelShow)="isOptionFilter=true;" [maxSelectedLabels]="1">
                    </p-multiSelect>
                </th>
            </ng-container>
        </tr> -->
    </ng-template>
    <ng-template pTemplate="body" let-rowData let-columns="columns">
        <tr>
            <ng-container *ngFor="let col of columns">
                <td *ngIf="col.field != '' && col.visibility">
                    <ng-container
                        *ngIf="col.field != '' && col.visibility &&  col.field !== 'Date' &&  col.field !== 'Rating'">
                        {{rowData[col.field]}}
                    </ng-container>
                    <ng-container *ngIf="col.field === 'Date'">
                        {{rowData[col.field] | date:'MMM d, yyyy' }}
                    </ng-container>
                    <ng-container *ngIf="col.field === 'Rating'">
                        {{rowData[col.field] }}
                        <div class='overlayIcon'
                            (click)="this.showOverlayPanel($event, rowData['ParameterRatings'], ratingOP)"
                            style="float: right;cursor: pointer;" title="Click to see rating split">
                            <i class="fa fa-info-circle" aria-hidden="true"></i>
                        </div>
                        <app-rating-overlay #ratingOP></app-rating-overlay>
                    </ng-container>
                </td>
            </ng-container>
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage" let-columns>
        <tr>
            <td [attr.colspan]="columns.length - 3">
                No Data found
            </td>
        </tr>
    </ng-template>
</p-table>


<div class="p-d-flex p-flex-column" style="padding:5vw;" *ngIf="!hideLoader">
    <div id="modalInnerLoader"></div>
    <div id="modalInnerLoaderText">Loading...</div>
</div>
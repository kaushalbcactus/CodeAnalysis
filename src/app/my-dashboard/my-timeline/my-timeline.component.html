<!--**************************************************************************************************
//  loader for event fetch
************************************************************************************************** -->

<div *ngIf="CalendarLoader">
    <div id="CalendarInnerLoader"></div>
    <div id="CalendarInnerLoaderText">Loading...</div>
</div>

<!--**************************************************************************************************
//  color codes for different status
************************************************************************************************** -->

<div *ngIf="!CalendarLoader" class="p-col p-grid p-mr-2 p-ai-center dropdowninfo" style=" position: absolute !important; right:250px;">
    <!-- <i class="pi pi-info-circle p-my-2 p-mr-2" (click)="op2.show($event)" style="font-size:1.5em;cursor: pointer;"></i> -->
    <button pButton pRipple type="button" (click)="op2.show($event)" icon="pi pi-info" class="p-button-outlined p-button-danger p-mr-2"></button>

    <p-overlayPanel appendTo="body" #op2 [dismissable]="true">

        <h5 class="p-mx-4 error">Task : </h5>
        <div class="p-col p-grid p-mx-2">
            <div *ngFor="let taskType of TasksTypeArrayCode" class="p-field-checkbox">
                <div class="p-ml-2" [style]="{'background-color': taskType.ColorIndicator, 'width': '1.2rem','height': '1.2rem', 'border-radius':'2px'}"></div>
                <label class="p-m-2" [for]="taskType.key">{{taskType.name}}</label>
            </div>
        </div>

        <h5 class="error p-mx-4 ">Adhoc : </h5>
        <div class="p-col p-grid p-mx-2">
            <div *ngFor="let taskType of AdhocTaskArrayCode" class="p-field-checkbox">
                <div class="p-ml-2" [style]="{'background-color': taskType.ColorIndicator, 'width': '1.2rem','height': '1.2rem', 'border-radius':'2px'}"></div>
                <label class="p-m-2" [for]="taskType.key">{{taskType.name}}</label>
            </div>
        </div>
    </p-overlayPanel>

    <p-dropdown [style]="{'min-width':'10.5em'}" appendTo="body" [options]="taskTypes" (onChange)="onTaskTypeChange()" [(ngModel)]="selectedType" optionLabel="name" class="timeline-dropdown"></p-dropdown>



    <div #plusIcon>
        <button pButton pRipple type="button" (click)="menuPopup.toggle($event)" icon="pi pi-plus" class="p-button-outlined p-button-danger p-mx-2"></button>
        <p-menu styleClass="timeline-plusIcon" #menuPopup [appendTo]="plusIcon" [popup]="true" [model]="items"></p-menu>

    </div>
</div>

<!--**************************************************************************************************
// full calendar 
************************************************************************************************** -->

<p-fullCalendar #calendar [ngStyle]="{'margin':'1em;'}" [events]="events" [options]="options">
</p-fullCalendar>


<ng-template #calendarPopover>
    <h3>{{toolData .title}}</h3>
</ng-template>

<!--**************************************************************************************************
//  dialog to to display data
************************************************************************************************** -->

<p-dialog *ngIf="taskdisplay" header="{{taskName}}" [contentStyle]="{'max-height':'90%'}" [style]="{'width':task.Task === 'Adhoc' ? '80vw': '100vw'}" [positionTop]="task.Task === 'Adhoc' ? '': '0'" [modal]="true" [draggable]="false" appendTo='body' [closable]="false"
    [(visible)]="taskdisplay">

    <div class="p-col-12 p-grid p-jc-end pdialogButton">


        <button type="button" pButton icon="pi pi-save" id="saveTime" (click)="UpdateTask()" [disabled]="(task.projectType !== constants.PROJECTTYPES.FTE && (task.Status === SelectedStatus  ||  SelectedStatus === undefined)) || (task.projectType === constants.PROJECTTYPES.FTE && (task.Status === constants.STATUS.COMPLETED  ||  SelectedStatus === undefined))"
            class="p-mx-1 p-button-raised p-button-danger" label="Update"></button>
        <button type="button" pButton icon="pi pi-times" (click)="cancel();taskdisplay=false" label="Cancel" class="p-button-raised p-button-danger"></button>
    </div>

    <!--*************************************************************************************************
//  dialog to show adhoc data
************************************************************************************************** -->

    <div *ngIf="task.Task === 'Adhoc'">
        <table style="width:100%;margin:10px 0px 0px 0px;">
            <tr>
                <th>Client Name:</th>
                <td>{{task.Entity}}</td>
                <th>Type :</th>
                <td>
                    {{task.Comments}}
                </td>
            </tr>
            <tr>
                <th>Start Date:</th>
                <td>{{task.StartDate | date :'medium'}}</td>
                <th>End Date:</th>
                <td>{{task.DueDateDT | date:'medium'}}</td>
            </tr>
            <tr>
                <!-- <th>Status:</th>
                <td>{{task.Status}}</td> -->
                <th>Time Spent:</th>
                <td>{{task.TimeSpent}} Hours</td>
                <th>Comments : </th>
                <td>
                    {{task.TaskComments}}
                </td>
            </tr>
        </table>

    </div>

    <!--**************************************************************************************************
//  dialog to load different component 
************************************************************************************************** -->


    <p-accordion class="p-mt-2" *ngIf="task.Task !== 'Adhoc'" (onOpen)="setStep($event.index)">


        <!--****************************************************************************************** 
        //  dialog to display task properties
        ****************************************************************************************** -->


        <p-accordionTab [selected]="step === 0">
            <ng-template pTemplate="header">
                <div class="p-col p-grid p-mt-0 p-p-0">
                    <h5 class="p-col p-px-2 p-pb-0 p-pt-1 p-m-0"><i class="pi pi-book p-mr-1" style="font-weight: bold;"></i>Task Properties</h5>
                </div>
            </ng-template>
            <ng-template pTemplate="content">
                <div class="p-d-flex p-flex-column" style="padding: 2vw;" *ngIf="modalloaderenable">
                    <div id="modalInnerLoader"></div>
                    <div id="modalInnerLoaderText">Loading...</div>
                </div>

                <table *ngIf="!modalloaderenable" class="p-col-12 p-datatable-cactus p-datatable-gridlines">
                    <tr>
                        <th>Project Name:</th>
                        <td>{{task.ProjectName}}</td>
                        <th rowspan="2">Assigned To:</th>
                        <td rowspan="2">{{task.AssignedTo.Title}}</td>
                    </tr>
                    <tr>
                        <th>Project Scope:</th>
                        <td><a style="cursor: pointer;color: #b11e1e;" (click)="goToProjectScope(task)"> {{task.ProjectCode}}_Scope.docx </a> </td>
                    </tr>
                    <tr>
                        <th>Start Date:</th>
                        <td>
                            <span *ngIf="task.projectType ===constants.PROJECTTYPES.FTE && SelectedStatus === constants.STATUS.NOT_STARTED && task.StartTime;else isStartConstant">
                            <p-calendar [(ngModel)]="task.StartDate" appendTo="body" dateFormat="M dd, yy" (onClose)="onCloseStartDate()" [disabledDays]="[0,6]" [yearNavigator]="true" yearRange="{{yearRangePastNext}}" placeholder="Select Start Date">
                            </p-calendar>
                            <input style="color: #333333; background: #ffffff;  padding: 0.429em;margin: 0px 8px 0px 10px; border: 1px solid #a6a6a6; border-radius: 4px;" aria-label="12hr format" [ngxTimepicker]="defaultStartTime" [(ngModel)]="task.StartTime" [format]="12"
                                readonly>

                            <ngx-material-timepicker #defaultStartTime [minutesGap]="15" [enableKeyboardInput]="false" (closed)="SetTime(task.StartTime, 'startTime')" [ngxMaterialTimepickerTheme]="darkTheme">
                            </ngx-material-timepicker>
                            </span>

                            <ng-template #isStartConstant>
                                {{task.StartDate | date :'medium'}}
                            </ng-template>
                        </td>
                        <th>End Date:</th>
                        <td>
                            <span *ngIf="task.projectType ===constants.PROJECTTYPES.FTE && SelectedStatus !==constants.STATUS.NOT_CONFIRMED  && task.DueTime;else isEndConstant">
<p-calendar [style]="{'border': '1px solid !important'}" placeholder="Select Due Date" (onClose)="onCloseDueDate()" [minDate]="task.StartDate" [(ngModel)]="task.DueDateDT" [disabledDays]="[0,6]" dateFormat="M dd, yy" appendTo="body" [monthNavigator]="true"
[yearNavigator]="true" yearRange="{{yearRangePastNext}}">
</p-calendar>
<input style="color: #333333; background: #ffffff;  padding: 0.429em;margin: 0px 8px 0px 10px; border: 1px solid #a6a6a6; border-radius: 4px;" aria-label="12hr format" [ngxTimepicker]="defaultEndTime" [(ngModel)]="task.DueTime" [format]="12"
readonly>
<ngx-material-timepicker #defaultEndTime [minutesGap]="15" [enableKeyboardInput]="false" (closed)="SetTime(task.DueTime, 'dueTime')" [ngxMaterialTimepickerTheme]="darkTheme">
</ngx-material-timepicker>
</span>

                            <ng-template #isEndConstant>
                                {{task.DueDateDT | date :'medium'}}
                            </ng-template>

                        </td>
                    </tr>
                    <tr>
                        <th>Milestone:</th>
                        <td>{{task.Milestone}}</td>
                        <th>Task / Scope / Allocated Time:</th>
                        <td>
                            <div class="p-col p-grid">
                                <span class="p-col p-grid p-ai-center">
                                {{task.Task}} / <span *ngIf="task.Comments">[{{task.Comments}}] /</span> {{task.ExpectedTime}}
                                </span>
                                <span class='p-col overlayIcon' appendTo="body" (click)="showOverlayPanel($event, task, dailyAllocateOP)" style="cursor: pointer;" title="Click to see allocation split">
                                    <i [hidden]="hideIcon" style="font-size: 17px;" class="fa fa-info-circle" aria-hidden="true"></i>
                                    <app-allocation-overlay #dailyAllocateOP></app-allocation-overlay>
                                </span>
                            </div>


                        </td>
                    </tr>
                    <tr>
                        <th>Status:</th>
                        <td>

                            <span *ngIf="task.Status !== 'Not Started' && task.Status !== 'In Progress'">
                            {{task.Status}} </span>
                            <p-dropdown [hidden]="task.Status !== 'Not Started' && task.Status !== 'In Progress'" [options]="statusOptions" [(ngModel)]="SelectedStatus" appendTo="body" class="p-fluid"></p-dropdown>

                        </td>
                        <th>Time Spent:</th>
                        <td>{{task.TimeSpent}} Hours</td>
                    </tr>
                    <tr>
                        <th>Previous Tasks:</th>
                        <td>
                            <div *ngFor="let task of tasks">
                                <span *ngIf="task.TaskType === 'Previous Task'">
                                {{task.Title}}
                                <span *ngIf="task.SubMilestones && task.SubMilestones !=='Default'">
                                    - {{task.SubMilestones}}
                                </span> ({{task.AssignedTo.Title}} - {{task.Status}})
                                </span>
                            </div>
                        </td>
                        <th>Next Tasks:</th>
                        <td>
                            <div *ngFor="let task of tasks">
                                <span *ngIf="task.TaskType === 'Next Task'">
                                {{task.Title}}
                                <span *ngIf="task.SubMilestones && task.SubMilestones !=='Default' ">
                                    - {{task.SubMilestones}}
                                </span> ({{task.AssignedTo.Title}} - {{task.Status}})
                                </span>
                            </div>
                        </td>
                    </tr>
                </table>
            </ng-template>
        </p-accordionTab>
        <!--****************************************************************************************** 
        //  dialog to display Time spent
        ****************************************************************************************** -->

        <p-accordionTab [selected]="step === 1">
            <ng-template pTemplate="header">
                <div class="p-col p-grid p-mt-0 p-p-0">
                    <h5 class="p-col p-px-2 p-pb-0 p-pt-1 p-m-0"><i class="pi pi-clock p-mr-1" style="font-weight: bold;"></i>Time Spent</h5>

                </div>
            </ng-template>
            <ng-template pTemplate="content">
                <app-time-spent-dialog [taskData]="task"></app-time-spent-dialog>
            </ng-template>
        </p-accordionTab>
        <!--****************************************************************************************** 
        //  dialog to add /view comment
        ****************************************************************************************** -->

        <p-accordionTab [selected]="step === 2">
            <ng-template pTemplate="header">
                <div class="p-col p-grid p-mt-0 p-p-0">
                    <h5 class="p-col p-px-2 p-pb-0 p-pt-1 p-m-0"><i class="pi pi-comments p-mr-1" style="font-weight: bold;"></i>View / Add Comments</h5>

                </div>
            </ng-template>
            <ng-template pTemplate="content">
                <app-add-edit-comment-dialog [taskData]="task"></app-add-edit-comment-dialog>
            </ng-template>
        </p-accordionTab>
        <!--****************************************************************************************** 
        //  dialog to add /view Document
        ****************************************************************************************** -->

        <p-accordionTab [selected]="step === 3">
            <ng-template pTemplate="header">
                <div class="p-col p-grid p-mt-0 p-p-0">
                    <h5 class="p-col p-px-2 p-pb-0 p-pt-1 p-m-0"><i class="pi pi-folder p-mr-1" style="font-weight: bold;"></i>View / Add Documents</h5>

                </div>
            </ng-template>
            <ng-template pTemplate="content">
                <app-view-upload-document-dialog [taskData]="task"></app-view-upload-document-dialog>
            </ng-template>
        </p-accordionTab>
    </p-accordion>
    <!--**************************************************************************************************
//  footer button for adhoc task
************************************************************************************************** -->
    <!-- <p-footer *ngIf="task.Task === 'Adhoc'">

        <button type="button" pButton icon="pi pi-times" (click)="taskdisplay=false" label="Close" class="ui-button-secondary"></button>
    </p-footer> -->
</p-dialog>




<!--**************************************************************************************************
//  leave deletion confirm dialog
************************************************************************************************** -->
<p-dialog *ngIf='leave' [closable]='false' [(visible)]="displayleave" [modal]="true" [style]="{'width': '80vw'}">
    <p-header>
        Delete Confirmation
    </p-header>
    <div class="p-mt-3">
        <span style="font-size: 16px;"><i class="pi pi-info-circle p-mr-2" style="font-size: 25px;vertical-align: middle;"></i>Do
            you want to delete this leave?</span>
        <div>
            <table class="p-mt-3 p-col-12">
                <tr>
                    <th> Start Date :</th>
                    <td>{{leave.EventDate | date:'EEE, MMM dd, yyyy'}}</td>
                    <th> End Date :</th>
                    <td>{{leave.EndDate | date:'EEE, MMM dd, yyyy'}}</td>
                    <th>Is Half Day :</th>
                    <td *ngIf='leave.IsHalfDay'>Yes</td>
                    <td *ngIf='!leave.IsHalfDay'>No</td>
                </tr>
                <tr>
                    <th>Comments:</th>
                    <td colspan="6">{{leave.Title}}</td>
                </tr>
            </table>
        </div>
    </div>
    <p-footer>
        <button class="p-button-raised p-button-danger" type="button" pButton icon="pi pi-check" label="Yes" (click)="DeleteLeave(leave);displayleave=false"></button>
        <button class="p-button-raised p-button-danger" type="button" pButton icon="pi pi-times" label="No" (click)="displayleave=false"></button>
    </p-footer>
</p-dialog>


<!-- <app-feedback-popup #feedbackPopup (popupClosed)='saveTask($event)'></app-feedback-popup> -->
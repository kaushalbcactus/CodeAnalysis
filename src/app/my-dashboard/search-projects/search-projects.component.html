<div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px" style="padding:0.3em;"> </div>


<div fxLayout="row" fxLayoutAlign="space-around center" fxLayoutGap="10px">
  <div></div>
  <form class="SearchForm" #SearchForm="ngForm" (ngSubmit)="SearchProject()">

    <div fxLayout="row" class="SearchBox" fxLayoutAlign="space-around center" fxLayoutGap="10px">
      <span style="color: #c53e3e; font-weight: 500;font-size:1.2em;"> Search Project</span>
      <span class="ui-float-label">
        <input id="float-input" type="text" name="ProjectCode" size="25" [(ngModel)]="ProjectCode"
          (focus)="focusFunction('ProjectCode')" pInputText>
        <label for="float-input">By Project Code</label>
      </span>
      <span style="color: #c53e3e; font-weight: 500;font-size:1.5em;"> OR</span>
      <span class="ui-float-label">
        <input id="float-input" type="text" class="form-control" name="ProjectTitle" [(ngModel)]="ProjectTitle"
          size="25" (focus)="focusFunction('ProjectTitle')" pInputText>
        <label for="float-input">By Short Title</label>
      </span>

      <button pButton type="submit" [disabled]="ProjectCode ==='' && ProjectTitle===''"
        [ngStyle]="{'cursor': ProjectCode ==='' && ProjectTitle==='' ? 'not-allowed':'pointer'}" icon="pi pi-search"
        label="Search" class="ui-button-danger"></button>
    </div>
  </form>
  <div></div>

</div>

<!-- **********************************************************************************************************
                                                      toaster message dialog
********************************************************************************************************** -->


<p-toast [style]="{marginTop: '80px'}" styleClass="custom-toast" key="custom" [hideTransitionOptions]="'0ms'"
  position="bottom-center">
</p-toast>



<!-- **********************************************************************************************************
                                                         loader enable 
********************************************************************************************************** -->
<div fxLayout="column" style="padding: 10vw;width: 100%;" fxLayoutAlign="center center" *ngIf="loaderenable">
  <div id="scInnerLoader"></div>
  <div id="scInnerLoaderText">Loading...</div>
</div>



<!-- **********************************************************************************************************
                                                          Table View Data
           ********************************************************************************************************** -->

<div *ngIf="!loaderenable && tableviewenable" style="padding-top: 5px;">
  <p-table #project [columns]="cols" [value]="ProjectList" [resizableColumns]="true" [exportFilename]="ProjectList">

    <ng-template pTemplate="header" let-columns>
      <tr>
        <th *ngFor="let col of columns" [pSortableColumn]="col.field" pResizableColumn pReorderableColumn>
          {{col.header}}
          <p-sortIcon *ngIf="col.header != '' " [field]="col.field"></p-sortIcon>
        </th>
        <th style="width: 3em;"></th>
      </tr>
      <tr>

        <th *ngFor="let col of columns" [ngSwitch]="col.field" class="ui-fluid">
          <ng-container *ngIf="col.field">

            <p-dropdown *ngSwitchCase="'SOWCode'" [options]="ProjectColArray.SOWCode" appendTo="body"
              (onChange)="project.filter($event.value, col.field, 'equals')"></p-dropdown>
            <p-dropdown *ngSwitchCase="'ProjectCode'" [options]="ProjectColArray.ProjectCode" appendTo="body"
              (onChange)="project.filter($event.value, col.field, 'equals')"></p-dropdown>
            <p-dropdown *ngSwitchCase="'WBJID'" [options]="ProjectColArray.WBJID" appendTo="body"
              (onChange)="project.filter($event.value, col.field, 'equals')"></p-dropdown>
            <p-dropdown *ngSwitchCase="'ClientLegalEntity'" [options]="ProjectColArray.ClientLegalEntity"
              appendTo="body" (onChange)="project.filter($event.value, col.field, 'equals')">
            </p-dropdown>
            <p-dropdown *ngSwitchCase="'DeliverableType'" [options]="ProjectColArray.DeliverableType" appendTo="body"
              (onChange)="project.filter($event.value, col.field, 'equals')"></p-dropdown>
            <p-dropdown *ngSwitchCase="'ProjectType'" [options]="ProjectColArray.ProjectType" appendTo="body"
              (onChange)="project.filter($event.value, col.field, 'equals')"></p-dropdown>
            <p-dropdown *ngSwitchCase="'Status'" [options]="ProjectColArray.Status" appendTo="body"
              (onChange)="project.filter($event.value, col.field, 'equals')"></p-dropdown>
            <p-dropdown *ngSwitchCase="'CreatedBy'" [options]="ProjectColArray.CreatedBy" appendTo="body"
              (onChange)="project.filter($event.value, col.field, 'equals')"></p-dropdown>

            <p-dropdown [options]="ProjectColArray.Created" *ngSwitchCase="'Created'" [(ngModel)]="selectedDate"
              appendTo="body" (onChange)="project.filter($event.value, col.field, 'equals')">
              <ng-template let-sDate pTemplate="selectedItem">
                <span *ngIf="sDate.value === null"> {{sDate.label}}</span>
                <span *ngIf="sDate.value !== null"> {{sDate.label | date:'d MMM, y, h:mm a'}}</span>
              </ng-template>
              <ng-template let-sDate pTemplate="item">
                <span *ngIf="sDate.value === null"> {{sDate.label}}</span>
                <span *ngIf="sDate.value !== null"> {{sDate.label | date:'d MMM, y, h:mm a'}}</span>
              </ng-template>
            </p-dropdown>


          </ng-container>
        </th>
        <th></th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-node="rowData" let-rowData let-columns="columns" let-rowIndex="rowIndex">
      <tr style="font-size: 12px;">
        <td *ngFor="let col of columns;index as i">
          <span *ngIf="col.field === 'Created'"> {{rowData[col.field] | date:'d MMM, y, h:mm a'}} </span>
          <span *ngIf="col.field !== 'Created'"> {{rowData[col.field]}} </span>
        </td>
        <td>
          <span>
            <p-slideMenu #popupMenu [popup]="true" appendTo="body" [model]="projectMenu">
            </p-slideMenu>

            <i class="pi pi-ellipsis-v" style="font-size:2em;cursor: pointer;"
              (click)="openPopup(rowData, popupMenu);popupMenu.toggle($event);"></i>
          </span>
        </td>
      </tr>
    </ng-template>

  </p-table>
</div>









<router-outlet></router-outlet>



<p-dialog *ngIf="showDetails" header="{{projectDisplayTitle}}" [contentStyle]="{'min-height':'85vh','max-height':'85vh'}"
  [style]="{'width':'100vw'}" [positionTop]="0" [modal]="true" [draggable]="false" appendTo='body'
  [(visible)]="showDetailsenable">

  <!-- <div class="timeLineButton" fxLayout="row" fxLayoutAlign="end center"  >

           
        
            <button type="button" pButton icon="pi pi-save" id="saveTime" style="margin-right:5px" (click)="UpdateTask()"  
              [disabled]="task.Status === SelectedStatus  ||  SelectedStatus === undefined" label="Update"></button>
            <button type="button"  pButton icon="pi pi-times" (click)="taskdisplay=false" label="Cancel" class="ui-button-secondary"
              style="background-color:ghostwhite;"></button>
          
          </div> -->

  <!--*************************************************************************************************
//  dialog to show adhoc data
************************************************************************************************** -->






  <!--**************************************************************************************************
//  dialog to load different component 
************************************************************************************************** -->

  <mat-accordion  >
    <!--****************************************************************************************** 
        //  dialog to display task proeprties
        ****************************************************************************************** -->

    <mat-expansion-panel  [expanded]="step === 0" (opened)="setStep(0)">
      <mat-expansion-panel-header>
        <mat-panel-title style="color:#000000;">
          <mat-icon style="padding: 4px 0px 0px 0px;">event_note</mat-icon>&nbsp;&nbsp; Project Properties
        </mat-panel-title>
        <ng-template matExpansionPanelContent>


          <div fxLayout="column" style="padding: 2vw;" fxLayoutAlign="center center" [hidden]="!modalloaderenable">
            <div id="modalInnerLoader"></div>
            <div id="modalInnerLoaderText">Loading...</div>
          </div>

          <table [hidden]="modalloaderenable" class="ProjectDetails" style="width:100%;margin:10px 0px 0px 0px;">
            <tr>
              <th>Client Name </th>
              <td>{{ProjectPopupDetails.ClientLegalEntity}}</td>
              <th>POC </th>
              <td>{{ProjectPopupDetails.POC}}</td>
            </tr>
            <tr>
              <th>Project Title </th>
              <td>{{ProjectPopupDetails.Title}}</td>
              <th>Status </th>
              <td>{{ProjectPopupDetails.Status}}</td>
            </tr>
            <tr>
              <th>Deliverable Type </th>
              <td>{{ProjectPopupDetails.DeliverableType}}</td>
              <th>Sub-Deliverable / Service </th>
              <td>{{ProjectPopupDetails.SubDeliverable}} / {{ProjectPopupDetails.ServiceLevel}} </td>
            </tr>
            <tr>
              <th>TA & Indication </th>
              <td>{{ProjectPopupDetails.TA}} & {{ProjectPopupDetails.Indication}}</td>
              <th>Molecule </th>
              <td>{{ProjectPopupDetails.Molecule}}</td>
            </tr>
            <tr>
              <th>Complexity </th>
              <td>{{ProjectPopupDetails.Complexity}}</td>
              <th>Priority </th>
              <td>{{ProjectPopupDetails.Priority}}</td>
            </tr>
            <tr>
              <th>Proposed Start Date </th>
            
              <td>
                <span
                  *ngIf="ProjectPopupDetails.ProposedStartDate !== null">{{ProjectPopupDetails.ProposedStartDate | date:'medium'}}
                </span>
              </td>
              <th>Proposed End Date </th>
              <td>
                <span
                  *ngIf="ProjectPopupDetails.ProposedEndDate !== null">{{ProjectPopupDetails.ProposedEndDate | date:'medium'}}
                </span>
              </td>
            </tr>
            <tr>
              <th>Confirmation Date</th>
              <td>
                <span
                  *ngIf="ProjectPopupDetails.ActualStartDate !== null">{{ProjectPopupDetails.ActualStartDate | date:'medium'}}
                </span>

              </td>
              <th>Actual End Date  </th>
              <td>
                <span
                  *ngIf="ProjectPopupDetails.ActualEndDate !== null">{{ProjectPopupDetails.ActualEndDate | date:'medium'}}
                </span>
              </td>
            </tr>
            <tr>
              <th>Pub Support Required</th>
              <td>{{ProjectPopupDetails.IsPubSupport}}</td>
              <th>Pub support Status  </th>
              <td>{{ProjectPopupDetails.PubSupportStatus}} </td>
            </tr>
            <tr>
              <th>Journel / Conference </th>
              <td>{{ProjectPopupDetails.ConferenceJournal}}</td>
              <th>Authors  </th>
              <td>{{ProjectPopupDetails.Authors}} </td>
            </tr>
            <tr>
              <th>Comments </th>
              <td colspan="3">{{ProjectPopupDetails.Comments}}</td>

            </tr>
          </table>

          <!-- <table [hidden]="modalloaderenable" style="width:100%;margin:10px 0px 0px 0px;">
                        <tr>
                            <th>Project Name:</th>
                            <td>{{task.ProjectName}}</td>
                            <th>Assigned To:</th>
                            <td>{{task.AssignedTo}}</td>
                        </tr>
                        <tr>
                            <th>Start Date:</th>
                            <td>{{task.StartDate | date :'medium'}}</td>
                            <th>End Date:</th>
                            <td>{{task.DueDate | date:'medium'}}</td>
                        </tr>
                        <tr>
                            <th>Milestone:</th>
                            <td>{{task.Milestone}}</td>
                            <th>Task & Scope:</th>
                            <td>{{task.Task}}</td>
                        </tr>
                        <tr>
                            <th>Status:</th>
                            <td>
                              
                                <span *ngIf="task.Status !== 'Not Started' && task.Status !== 'In Progress'"> {{task.Status}} </span>
                                <p-dropdown  [hidden]="task.Status !== 'Not Started' && task.Status !== 'In Progress'"    [options]="statusOptions" [(ngModel)]="SelectedStatus" appendTo="body" [style]="{'width':'100%'}"></p-dropdown>

                            </td>
                            <th>Time Spent:</th>
                            <td></td>
                        </tr>
                        <tr>
                            <th>Previous Tasks:</th>
                            <td>
                                <div *ngFor="let task of tasks">
                                    <span *ngIf="task.TaskType === 'Previous Task'">
                                        {{task.Title}} ({{task.AssignedTo.Title}} - {{task.Status}})
                                    </span>
                                </div>
                            </td>
                            <th>Next Tasks:</th>
                            <td>
                                <div *ngFor="let task of tasks">
                                    <span *ngIf="task.TaskType === 'Next Task'">
                                        {{task.Title}} ({{task.AssignedTo.Title}} - {{task.Status}})
                                    </span>
                                </div>
                            </td>
                        </tr>
                    </table> -->
        </ng-template>
      </mat-expansion-panel-header>


    </mat-expansion-panel>



    <!--****************************************************************************************** 
        //  dialog to display Project Resources
        ****************************************************************************************** -->

    <mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)">
      <mat-expansion-panel-header>
        <mat-panel-title style="color:#000000;">
          <mat-icon style="padding: 4px 0px 0px 0px;">event_note</mat-icon>&nbsp;&nbsp; Project Resources
        </mat-panel-title>
        <ng-template matExpansionPanelContent>


          <div fxLayout="column" style="padding: 2vw;" fxLayoutAlign="center center" [hidden]="!modalloaderenable">
            <div id="modalInnerLoader"></div>
            <div id="modalInnerLoaderText">Loading...</div>
          </div>

          <table [hidden]="modalloaderenable" class="ProjectDetails" style="width:100%;margin:10px 0px 0px 0px;">
            <tr>
              <th>CM Members </th>
              <td>{{projectResource.CMMembers}}</td>
              <th>Delivery Members </th>
              <td>{{projectResource.PMMembers}}</td>
            </tr>
            <tr>
              <th>Writers </th>
              <td>{{projectResource.Writers}}</td>
              <th>Reviewers </th>
              <td>{{projectResource.Reviewers}}</td>
            </tr>
            <tr>
              <th>Editors </th>
              <td>{{projectResource.Editors}}</td>
              <th>QCers </th>
              <td>{{projectResource.QC}}</td>
            </tr>
            <tr>
              <th>Graphics Designers </th>
              <td>{{projectResource.GraphicsMembers}}</td>
              <th>Publication Support </th>
              <td>{{projectResource.PubSupport}}</td>
            </tr>
            <tr>
              <th>Primary Resources </th>
              <td colspan="3">{{projectResource.PrimaryResource}}</td>

            </tr>
          </table>
        </ng-template>
      </mat-expansion-panel-header>


    </mat-expansion-panel>

    <!--****************************************************************************************** 
        //  dialog to display Time spent
        ****************************************************************************************** -->

    <!-- <mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)">
            <mat-expansion-panel-header>
                <mat-panel-title style="color:#000000;">
                    <mat-icon style="padding: 4px 0px 0px 0px;">timer</mat-icon>&nbsp;&nbsp; Time Spent
                </mat-panel-title>

                <ng-template matExpansionPanelContent>
                    <app-time-spent-dialog [taskData]="task"></app-time-spent-dialog>
                </ng-template>

            </mat-expansion-panel-header>


        </mat-expansion-panel> -->

    <!--****************************************************************************************** 
        //  dialog to add /view comment
        ****************************************************************************************** -->

    <!-- <mat-expansion-panel [expanded]="step === 2" (opened)="setStep(2)">
            <mat-expansion-panel-header>
                <mat-panel-title style="color:#000000;">
                    <mat-icon style="padding: 4px 0px 0px 0px;">comment</mat-icon> &nbsp;&nbsp; View / Add Comments
                </mat-panel-title>

                <ng-template matExpansionPanelContent>
                    <app-add-edit-comment-dialog [taskData]="task"></app-add-edit-comment-dialog>
                </ng-template>

            </mat-expansion-panel-header>


        </mat-expansion-panel> -->

    <!--****************************************************************************************** 
        //  dialog to add /view Document
        ****************************************************************************************** -->
    
        <mat-expansion-panel [expanded]="step === 2" (opened)="setStep(2)">
            <mat-expansion-panel-header>
                <mat-panel-title style="color:#000000;">
                    <mat-icon style="padding: 4px 0px 0px 0px;">folder</mat-icon> &nbsp;&nbsp; View / Add Documents
                </mat-panel-title>

            </mat-expansion-panel-header>
            <ng-template matExpansionPanelContent>
                <app-view-upload-document-dialog [taskData]="ProjectPopupDetails"></app-view-upload-document-dialog>
            </ng-template>

        </mat-expansion-panel>

            <!--****************************************************************************************** 
        //  dialog to show project drafts
        ****************************************************************************************** -->
    
        <mat-expansion-panel [expanded]="step === 3" (opened)="setStep(3)">
            <mat-expansion-panel-header>
                <mat-panel-title style="color:#000000;">
                    <mat-icon style="vertical-align: middle;">timeline</mat-icon> &nbsp;&nbsp; Project Timeline
                </mat-panel-title>

            </mat-expansion-panel-header>
            <ng-template matExpansionPanelContent>
                <!-- <app-timeline [projectDetails] ="ProjectPopupDetails" ></app-timeline> -->
            </ng-template>

        </mat-expansion-panel>

     

         <!--****************************************************************************************** 
        //  dialog to show project drafts
        ****************************************************************************************** -->
    
        <mat-expansion-panel [expanded]="step === 4" (opened)="setStep(4)">
            <mat-expansion-panel-header>
                <mat-panel-title style="color:#000000;">
                    <mat-icon style="padding: 4px 0px 0px 0px;">folder</mat-icon> &nbsp;&nbsp; Project Drafts
                </mat-panel-title>

            </mat-expansion-panel-header>
            <ng-template matExpansionPanelContent>
                <app-project-drafts [milestoneData]="ProjectPopupDetails"></app-project-drafts>
            </ng-template>

        </mat-expansion-panel>


        
  </mat-accordion>


      <p-footer>
          <button type="button" pButton icon="pi pi-check" (click)="onCancel();showDetailsenable=false" label="Yes"></button>
        
      </p-footer>
  
</p-dialog>